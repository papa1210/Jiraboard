Hướng dẫn triển khai Gitea + Jenkins trên LAN

1. Giới thiệu

Gitea là một Git server nhẹ, miễn phí, dễ triển khai cho nhóm nhỏ. Jenkins là công cụ CI/CD phổ biến, miễn phí, có thể tích hợp với Gitea để tự động build và deploy. Kết hợp cả hai trên mạng LAN giúp bạn có hệ thống version control và CI/CD hoàn chỉnh mà không cần internet.

2. Chuẩn bị

Máy chủ LAN (Linux/Windows, khuyến nghị Linux Ubuntu/Debian).

Quyền sudo/root để cài đặt.

Docker hoặc cài đặt trực tiếp.

Máy dev cùng mạng LAN.

3. Cài đặt Gitea

3.1 Cài đặt qua Docker

# Tạo thư mục dữ liệu
mkdir -p /srv/gitea/{data,config}

# Chạy container Gitea
docker run -d --name gitea 
  -p 3000:3000 -p 222:22 
  -v /srv/gitea/data:/data 
  gitea/gitea:latest

3.2 Cài đặt trực tiếp (Ubuntu)

sudo adduser --system --group --disabled-password gitea
wget -O gitea https://dl.gitea.io/gitea/latest/gitea-linux-amd64
chmod +x gitea
sudo mv gitea /usr/local/bin/

3.3 Cấu hình ban đầu

Truy cập http://<LAN-IP>:3000.

Thiết lập database (SQLite/MySQL/Postgres).

Tạo admin account.

Tạo repository.

4. Cài đặt Jenkins

4.1 Cài đặt qua Docker

mkdir -p /srv/jenkins

# Chạy container Jenkins
sudo docker run -d --name jenkins 
  -p 8080:8080 -p 50000:50000 
  -v /srv/jenkins:/var/jenkins_home 
  jenkins/jenkins:lts

4.2 Cài đặt trực tiếp (Ubuntu)

wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -
sudo sh -c 'echo deb https://pkg.jenkins.io/debian-stable binary/ > 
    /etc/apt/sources.list.d/jenkins.list'
sudo apt update
sudo apt install openjdk-11-jdk jenkins -y

4.3 Truy cập Jenkins

Mở http://<LAN-IP>:8080.

Lấy mật khẩu từ /var/jenkins_home/secrets/initialAdminPassword.

Cài plugin cần thiết.

5. Tích hợp Gitea với Jenkins

5.1 Cài plugin Gitea

Vào Jenkins → Manage Jenkins → Manage Plugins.

Cài plugin Gitea Plugin.

5.2 Tạo Webhook trong Gitea

Vào repo → Settings → Webhooks.

Thêm webhook: http://<LAN-IP>:8080/gitea-webhook/post.

5.3 Tạo Job trong Jenkins

New Item → Freestyle Project.

Source Code Management → Git → nhập URL repo LAN.

Build Trigger → chọn “Gitea Webhook”.

Build Steps → thêm script build/deploy.

Ví dụ:

#!/bin/bash
echo "Building project..."
# chạy lệnh build
./gradlew build

echo "Deploying..."
# copy file build ra server ứng dụng
scp build/libs/app.jar user@192.168.1.200:/srv/app/

6. Đồng bộ với GitHub/GitLab khi có internet

Thêm remote thứ hai:

git remote add origin https://github.com/username/project.git
git remote add lan ssh://git@192.168.1.100:/srv/git/project.git

Push/pull tùy điều kiện mạng.

7. Kết luận

Với Gitea + Jenkins trên LAN, bạn có thể:

Quản lý code bằng Git ngay cả khi không có internet.

Tự động build và deploy trong mạng nội bộ.

Đồng bộ với cloud khi có internet.

Hệ thống này phù hợp cho cá nhân hoặc team nhỏ, chi phí bằng 0, dễ triển khai và duy trì.